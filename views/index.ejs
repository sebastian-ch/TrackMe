<!DOCTYPE html>
<html lang='en'>

<head>
    <title>Where Is Sebastian!</title>
    <meta charset='utf-8'>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

    <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
    <link href="style/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" />

</head>

<body>
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
    <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
    <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>


    <div class='sidebar'>
        <div class='text-side'>
            <p>This NodeJS app makes a heat map of me. Updates every 5 minutes or so.</p>
            <p>View the code <a href="https://github.com/sebastian-ch/TrackMe" target="_blank">here</a></p>

            <button class="button" onclick="flyToGeorgia()">Georgia</button>
            <button class="button" onclick="flyToVienna()">Vienna</button>
            <button class="button" onclick="flyToPH()">Philippines</button>
        
        <div id='data-points'></div>

    </div>
    <div id='map'></div>
    <script>
        var map = L.map('map', {
            //center: [48.205, 16.375],
            //zoom: 15
            //center: [10.802, 119.526],
            //zoom: 10
        });

        map.createPane('labels');
        map.getPane('labels').style.zIndex = 650;
        map.getPane('labels').style.pointerEvents = 'none';

        var basemap = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        var labels = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_only_labels/{z}/{x}/{y}.png', {
            maxZoom: 18,
            pane: 'labels'
        }).addTo(map);

        var group = L.layerGroup();
        getData();

        function getData() {

            d3.csv('data/file.csv').then(function (data) {

                document.getElementById('data-points').textContent = 'Heat map made with ' + data.length.toString() + ' data points.'
                //dontAddDupes(data)
                heatMapIt(data);
                map.setView(data[data.length -1], 13);

            })

        }

        function heatMapIt(data) {
            //console.log(data)

            var heat = L.heatLayer(data, {
                radius: 16,
                blur: 13,
                maxZoom: 17,
                minOpacity: 0.4,
                
            }).addTo(map);

        }


        function flyToGeorgia(){
            map.setView([41.976, 43.433], 9);

        }

        function flyToVienna(){
            map.setView([48.205, 16.375], 15)
        }

        function flyToPH(){
            map.setView([12.007, 119.729], 7)
        }
    </script>
</body>

</html>